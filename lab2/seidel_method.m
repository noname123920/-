% Метод Зейделя для СЛАУ
clear all; clc;

% Исходные данные
A = [-7, 2, 40, 0;
      9, -5, 0, 50;
      25, 0, 4, -1;
      0, 32, 0, 9];
b = [21; -14; 13; 21];

% Система с диагональным преобладанием
A1 = [25, 0, 4, -1;
       0, 32, 0, 9;
      -7, 2, 40, 0;
       9, -5, 0, 50];
b1 = [13; 21; 21; -14];

% Параметры метода
epsilon = 1e-4; % Точность
x0 = zeros(4, 1); % Начальное приближение
max_iter = 1000; % Максимальное число итераций

% Построение матрицы B и вектора c для метода Якоби
D = diag(diag(A1)); % D - диагональная матрица из A1
B = eye(4) - D \ A1; % B = E - D^(-1)*A1
c = D \ b1; % c = D^(-1)*b1

% Разложение матрицы B для метода Зейделя
B1 = tril(B, -1);  % Нижняя треугольная часть (без диагонали)
B2 = triu(B, 1);   % Верхняя треугольная часть (без диагонали)

fprintf('\nМатрица B:\n'); disp(B);
fprintf('Матрица B1 (нижняя треугольная):\n'); disp(B1);
fprintf('Матрица B2 (строго верхняя треугольная):\n'); disp(B2);
fprintf('Вектор c: \n'); disp(c');

% Вычисление норм
B_norm = norm(B, 1);
B2_norm = norm(B2, 1);

fprintf('Норма матрицы B (L1): %.6f\n', B_norm);
fprintf('Норма матрицы B2 (L1): %.6f\n', B2_norm);

% Проверка условия сходимости
if B_norm >= 1
    fprintf('Внимание: условие сходимости не выполнено (||B||₁ >= 1)\n');
else
    fprintf('Условие сходимости выполнено (||B||₁ < 1)\n');
end

% Критерий окончания для метода Зейделя
stopping_criterion = ((1 - B_norm) / B2_norm) * epsilon;
fprintf('Критерий окончания: ((1-||B||₁)/||B2||₁)*ε = %.6e\n', stopping_criterion);

% Вычисление матрицы для итерационного процесса (E - B1)^(-1)*B2
E = eye(4);
B_seidel = (E - B1) \ B2;
c_seidel = (E - B1) \ c;

fprintf('\nМатрица (E-B1)^(-1)*B2 для метода Зейделя:\n'); disp(B_seidel);
fprintf('Вектор (E-B1)^(-1)*c для метода Зейделя:\n'); disp(c_seidel');

% Начальное приближение
x = zeros(4, 1);
x_old = x;

fprintf('\nМЕТОД ЗЕЙДЕЛЯ (l₁-пространство)\n');
fprintf('============================================================================================================\n');
fprintf('№ итерации     x1(k)         x2(k)         x3(k)         x4(k)       ||x(k)-x(k-1)||₁    ((1-||B||₁)/||B2||₁)*ε\n');
fprintf('============================================================================================================\n');

k = 0;
diff_norm = stopping_criterion + 1; % Гарантирует вход в цикл
fprintf('%4d %14.6f %14.6f %14.6f %14.6f %14.6f %14.6e\n', ...
        k, x(1), x(2), x(3), x(4), diff_norm, stopping_criterion);

% Метод Зейделя
while diff_norm > stopping_criterion
    k = k + 1;

    % Реализация метода Зейделя через матричную формулу
    x = B_seidel * x_old + c_seidel;

    % l₁-норма разности
    diff_norm = norm(x - x_old, 1);

    fprintf('%4d %14.6f %14.6f %14.6f %14.6f %14.6f %14.6e\n', ...
            k, x(1), x(2), x(3), x(4), diff_norm, stopping_criterion);

    x_old = x;
end

x_seidel = x;
fprintf('\nРешение методом Зейделя:\n');
disp(x_seidel');
fprintf('Количество итераций: %d\n', k);

% Вычисление невязки в l₁-пространстве
R_seidel = A * x_seidel - b;
fprintf('Невязка метода Зейделя (l₁-норма): %e\n', norm(R_seidel, 1));
fprintf('Компоненты невязки:\n');
disp(R_seidel');

% Проверка точности
fprintf('\nПроверка точности:\n');
fprintf('||x(k)-x(k-1)||₁ = %.2e\n', diff_norm);
fprintf('((1-||B||₁)/||B2||₁)*ε = %.2e\n', stopping_criterion);
if diff_norm <= stopping_criterion
    fprintf('✓ Критерий окончания выполнен!\n');
else
    fprintf('✗ Критерий окончания не выполнен за %d итераций\n', max_iter);
end

% Сравнение с прямым решением
x_direct = A \ b;
fprintf('\nСравнение с прямым решением:\n');
fprintf('Метод Зейделя:        [%.6f, %.6f, %.6f, %.6f]\n', x_seidel);
fprintf('Прямое решение:       [%.6f, %.6f, %.6f, %.6f]\n', x_direct');
fprintf('Разность:             [%.2e, %.2e, %.2e, %.2e]\n', x_seidel - x_direct);
