% Метод Зейделя для СЛАУ
clear all; clc;

% Исходные данные
A = [-7, 2, 40, 0;
      9, -5, 0, 50;
      25, 0, 4, -1;
      0, 32, 0, 9];
b = [21; -14; 13; 21];

% Система с диагональным преобладанием
A1 = [25, 0, 4, -1;
       0, 32, 0, 9;
      -7, 2, 40, 0;
       9, -5, 0, 50];
b1 = [13; 21; 21; -14];

% Параметры
epsilon = 1e-4;
x0 = zeros(4, 1);

% Метод Зейделя (правильная реализация)
fprintf('┌─────┬────────────┬────────────┬────────────┬────────────┬──────────────────┬────────────────────┐\n');
fprintf('│ №   │    x1      │    x2      │    x3      │    x4      │ ‖x^(k)-x^(k-1)‖  │ (1-‖B‖)*ε/‖B2‖    │\n');
fprintf('├─────┼────────────┼────────────┼────────────┼────────────┼──────────────────┼────────────────────┤\n');

x_old = x0;
k = 0;
diff_norm = epsilon + 1;

% Вычисление B2 для критерия
D = diag(diag(A1));
U = triu(A1, 1);
B2 = D \ U;
B_norm = norm(B2, 1);
criterion_value = (1 - B_norm) * epsilon / B_norm;

while diff_norm >= epsilon
    k = k + 1;
    x_new = x_old;

    % Последовательное обновление компонент
    for i = 1:4
        sum1 = A1(i, 1:i-1) * x_new(1:i-1);
        sum2 = A1(i, i+1:4) * x_old(i+1:4);
        x_new(i) = (b1(i) - sum1 - sum2) / A1(i,i);
    end

    diff_norm = norm(x_new - x_old, 1);

    fprintf('│ %3d │ %10.6f │ %10.6f │ %10.6f │ %10.6f │ %16.6e │ %18.6e │\n', ...
            k, x_new(1), x_new(2), x_new(3), x_new(4), diff_norm, criterion_value);

    x_old = x_new;
end

fprintf('└─────┴────────────┴────────────┴────────────┴────────────┴──────────────────┴────────────────────┘\n');

% Определение номера итерации с достижением точности

fprintf('\nТочность достигнута на итерации: %d\n', k);

% Решение системы
fprintf('\nРешение системы x* (итерация %d):\n', k);
fprintf('x* = [%.8f, %.8f, %.8f, %.8f]\n', x_new(1), x_new(2), x_new(3), x_new(4));

% Невязка для преобразованной системы
R1 = A1 * x_new - b1;
fprintf('\nНевязка R = A1*x* - b1:\n');
fprintf('R = [%.2e, %.2e, %.2e, %.2e]\n', R1(1), R1(2), R1(3), R1(4));
fprintf('Норма невязки: %e\n', norm(R1, 1));

% Невязка для исходной системы
R_original = A * x_new - b;
fprintf('\nНевязка для исходной системы R = A*x* - b:\n');
fprintf('R = [%.2e, %.2e, %.2e, %.2e]\n', R_original(1), R_original(2), R_original(3), R_original(4));
fprintf('Норма невязки: %e\n', norm(R_original, 1));
