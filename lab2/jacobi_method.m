% Пункт 1: Решить систему Ax = b прямым делением x = b/A
A = [-7, 2, 40, 0;
      9, -5, 0, 50;
      25, 0, 4, -1;
      0, 32, 0, 9];
b = [21; -14; 13; 21];


% Пункт 2: Перестановка строк для диагонального преобладания
A1 = [25, 0, 4, -1;
       0, 32, 0, 9;
      -7, 2, 40, 0;
       9, -5, 0, 50];
b1 = [13; 21; 21; -14];

% Пункт 3: Проверить, что решение системы A1x = b1 совпадает с решением системы Ax = b
x_A = A \ b;
x_A1 = A1 \ b1;
display(x_A)
display(x_A1)

% Пункт 4: Метод простой итерации x^(k+1) = Bx^(k) + c

epsilon = 1e-4; % Требуемая точность 10^-4 из задания
x0 = zeros(4, 1); % Начальное приближение x^(0) = [0,0,0,0]^T

% Построение матрицы B и вектора c(метод Якоби)
D = diag(diag(A1)); % D - диагональная матрица из A1
B = eye(4) - D \ A1; % B = E - D^(-1)*A1 (итерационная матрица)
c = D \ b1; % c = D^(-1)*b1

% Итерационный процесс
x_old = x0; % x^(0) - начальное приближение
k = 0; % Счетчик итераций
diff_norm = epsilon + 1; % Гарантирует вход в цикл while

fprintf('┌─────┬────────────┬────────────┬────────────┬────────────┬──────────────────┬────────────────────┐\n');
fprintf('│ №   │    x1      │    x2      │    x3      │    x4      │ ‖x^(k)-x^(k-1)‖  │ (1-‖B‖)*ε/‖B‖     │\n');
fprintf('├─────┼────────────┼────────────┼────────────┼────────────┼──────────────────┼────────────────────┤\n');

while diff_norm >= epsilon
    k = k + 1;
    x_new = B * x_old + c;
    diff_norm = norm(x_new - x_old, 1);
    B_norm = norm(B, 1);
    criterion = (1 - B_norm) * epsilon / B_norm; % Критерий из таблицы задания

    fprintf('│ %3d │ %10.6f │ %10.6f │ %10.6f │ %10.6f │ %16.6e │ %18.6e │\n', ...
            k, x_new(1), x_new(2), x_new(3), x_new(4), diff_norm, criterion);

    x_old = x_new;
end

fprintf('└─────┴────────────┴────────────┴────────────┴────────────┴──────────────────┴────────────────────┘\n');

% Пункт 5: Сравнивая две последние колонки таблицы определить номер итерации
fprintf('\n5. Точность достигнута на итерации: %d\n', k);

% Пункт 6: Выписать решение системы x*
fprintf('\n6. Решение системы x*:\n');
fprintf('x* = [%.8f, %.8f, %.8f, %.8f]\n', x_new(1), x_new(2), x_new(3), x_new(4));

% Пункт 7: Вычислить невязку R = Ax* - b
R = A * x_new - b;
fprintf('\n7. Невязка R = Ax* - b:\n');
fprintf('R = [%.2e, %.2e, %.2e, %.2e]\n', R(1), R(2), R(3), R(4));
fprintf('Норма невязки: %e\n', norm(R, 1));
