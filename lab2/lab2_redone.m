% Лабораторная работа №2
% Метод простой итерации

clear all; clc;

%% Исходные данные
A = [-7, 2, 40, 0;
      9, -5, 0, 50;
      25, 0, 4, -1;
      0, 32, 0, 9];

b = [21; -14; 13; 21];
epsilon = 1e-4;
max_iter = 100;

% 1. Решение прямым делением
x_direct = A \ b;
fprintf('x_direct (решение 1-й системы) = \n'); disp(x_direct');

% 2. Перестановка строк для диагонального преобладания
A1 = [A(3,:); A(4,:); A(1,:); A(2,:)];
b1 = [b(3); b(4); b(1); b(2)];

fprintf('\nМатрица A1 после перестановки:\n'); disp(A1);
fprintf('Вектор b1: \n'); disp(b1');

% Проверяем диагональное преобладание (для информации)
fprintf('\nПроверка диагонального преобладания:\n');
for i = 1:4
    row_sum = sum(abs(A1(i,:))) - abs(A1(i,i));
    fprintf('%d: |a_ii| = %.1f, сумма недиагональных элементов = %.1f\n', ...
            i, abs(A1(i,i)), row_sum);
end

% 3. Проверка решения новой системы (пункт 3 задания)
x_check = A1 \ b1;
fprintf('\nРешение системы A1x = b1 (совпадает с x_direct):\n'); disp(x_check');

% Приводим систему к виду x = B*x + c
D = diag(diag(A1));
B = eye(4) - D\A1;
c = D\b1;
B_norm = norm(B, 1);

fprintf('\nМатрица B:\n'); disp(B);
fprintf('Вектор c: \n'); disp(c');
fprintf('Норма матрицы B (L1): %.6f\n', B_norm);

% Проверка условия сходимости
if B_norm >= 1
    fprintf('Внимание: условие сходимости не выполнено (||B||₁ >= 1)\n');
else
    fprintf('Условие сходимости выполнено (||B||₁ < 1)\n');
end

% Критерий окончания (порог точности для разницы итераций)
stopping_criterion_value = ((1 - B_norm) / B_norm) * epsilon;
fprintf('Критерий окончания: ((1-||B||₁)/||B||₁)*ε = %.6e\n', stopping_criterion_value);

% Начальное приближение
x = zeros(4, 1);
x_old = x;

fprintf('\nМЕТОД ПРОСТОЙ ИТЕРАЦИИ (l₁-пространство)\n');
fprintf('==================================================================================================================================================================================================================\n');
% 4. Заголовок таблицы (пункт 4 задания)
fprintf('№_итерации |     x1(k)   |     x2(k)   |     x3(k)   |     x4(k)   | ||x(k)-x(k-1)||₁ | ((1-||B||₁)/||B||₁)*ε | ||R(k)||₁\n');
fprintf('==================================================================================================================================================================================================================\n');

k = 0;
diff_norm = 0;
R0 = A * x - b; % Невязка для нулевого приближения
fprintf('%10d | %11.6f | %11.6f | %11.6f | %11.6f | %15.6f | %21.6e | %9.2e\n', ...
        k, x(1), x(2), x(3), x(4), diff_norm, stopping_criterion_value, norm(R0, 1));

k = 1;
while k <= max_iter
    x_old = x;
    x = B * x_old + c;

    % l₁-норма разности
    diff_norm = norm(x - x_old, 1);

    % Вычисление невязки для текущего приближения (для вывода в таблицу)
    R_current = A * x - b;
    R_norm = norm(R_current, 1);

    % 4. Вывод строки таблицы с дополнительным столбцом невязки
    fprintf('%10d | %11.6f | %11.6f | %11.6f | %11.6f | %15.6f | %21.6e | %9.2e\n', ...
            k, x(1), x(2), x(3), x(4), diff_norm, stopping_criterion_value, R_norm);

    % 5. Критерий окончания: ||x(k) - x(k-1)||₁ < ((1-||B||₁)/||B||₁) * ε
    if diff_norm <= stopping_criterion_value
        break; % Остановка, точность достигнута
    end

    k = k + 1;
end

x_simple = x; % 6. Финальное решение (пункт 6 задания)

fprintf('\n===================================================================\n');
fprintf('Решение методом простой итерации:\n');
disp(x_simple');
fprintf('Количество итераций (пункт 5 задания): %d\n', k);

% 7. Вычисление итоговой невязки (пункт 7 задания)
R_simple = A * x_simple - b;
fprintf('Невязка итогового решения (l₁-норма): %e\n', norm(R_simple, 1));
fprintf('Компоненты невязки:\n');
disp(R_simple');

% Проверка точности
fprintf('\nПроверка точности:\n');
fprintf('||x(k)-x(k-1)||₁ = %.2e\n', diff_norm);
fprintf('Критерий окончания = %.2e\n', stopping_criterion_value);
if diff_norm < stopping_criterion_value
    fprintf('✓ Критерий окончания выполнен! Точность ε=%.e достигнута.\n', epsilon);
else
    fprintf('✗ Критерий окончания не выполнен за %d итераций\n', max_iter);
end

% Сравнение с прямым решением
fprintf('\nСравнение с прямым решением:\n');
fprintf('Метод простой итерации: [%.6f, %.6f, %.6f, %.6f]\n', x_simple);
fprintf('Прямое решение:         [%.6f, %.6f, %.6f, %.6f]\n', x_direct');
fprintf('Разность:               [%.2e, %.2e, %.2e, %.2e]\n', x_simple - x_direct);



% Метод Зейделя
fprintf('=== МЕТОД ЗЕЙДЕЛЯ ===\n');


B1 = tril(B);      % Нижняя треугольная часть (включая диагональ)
B2 = triu(B, 1);   % Строго верхняя треугольная часть (без диагонали)

fprintf('\nМатрица B:\n'); disp(B);
fprintf('Матрица B1 (нижняя треугольная):\n'); disp(B1);
fprintf('Матрица B2 (строго верхняя треугольная):\n'); disp(B2);
fprintf('Вектор c: \n'); disp(c');

% Вычисление норм
B_norm = norm(B, 1);
B2_norm = norm(B2, 1);

fprintf('Норма матрицы B (L1): %.6f\n', B_norm);
fprintf('Норма матрицы B2 (L1): %.6f\n', B2_norm);

% Проверка условия сходимости
if B_norm >= 1
    fprintf('Внимание: условие сходимости не выполнено (||B||₁ >= 1)\n');
else
    fprintf('Условие сходимости выполнено (||B||₁ < 1)\n');
end

% Критерий окончания для метода Зейделя
stopping_criterion = ((1 - B_norm) / B2_norm) * epsilon;
fprintf('Критерий окончания: ((1-||B||₁)/||B2||₁)*ε = %.6e\n', stopping_criterion);

% Вычисление матрицы для итерационного процесса (E - B1)^(-1)*B2
E = eye(4);
B_seidel = (E - B1) \ B2;
c_seidel = (E - B1) \ c;

fprintf('\nМатрица (E-B1)^(-1)*B2 для метода Зейделя:\n'); disp(B_seidel);
fprintf('Вектор (E-B1)^(-1)*c для метода Зейделя:\n'); disp(c_seidel');

% Начальное приближение
x = zeros(4, 1);
x_old = x;

fprintf('\nМЕТОД ЗЕЙДЕЛЯ (l₁-пространство)\n');
fprintf('============================================================================================================\n');
fprintf('№ итерации     x1(k)         x2(k)         x3(k)         x4(k)       ||x(k)-x(k-1)||₁    ((1-||B||₁)/||B2||₁)*ε\n');
fprintf('============================================================================================================\n');

k = 0;
diff_norm = 0;
fprintf('%4d %14.6f %14.6f %14.6f %14.6f %14.6f %14.6e\n', ...
        k, x(1), x(2), x(3), x(4), diff_norm, stopping_criterion);

% Метод Зейделя
k = 1;
while k <= max_iter
    x_old = x;

    % Реализация метода Зейделя через матричную формулу
    x = B_seidel * x_old + c_seidel;

    % l₁-норма разности
    diff_norm = norm(x - x_old, 1);

    fprintf('%4d %14.6f %14.6f %14.6f %14.6f %14.6f %14.6e\n', ...
            k, x(1), x(2), x(3), x(4), diff_norm, stopping_criterion);

    % Критерий окончания: ||x(k) - x(k-1)||₁ <= ((1-||B||₁)/||B2||₁) * ε
    if diff_norm <= stopping_criterion
        break;
    end

    k = k + 1;
end

x_seidel = x;
fprintf('\nРешение методом Зейделя:\n');
disp(x_seidel');
fprintf('Количество итераций: %d\n', k);

% Вычисление невязки в l₁-пространстве
R_seidel = A * x_seidel - b;
fprintf('Невязка метода Зейделя (l₁-норма): %e\n', norm(R_seidel, 1));
fprintf('Компоненты невязки:\n');
disp(R_seidel');

% Проверка точности
fprintf('\nПроверка точности:\n');
fprintf('||x(k)-x(k-1)||₁ = %.2e\n', diff_norm);
fprintf('((1-||B||₁)/||B2||₁)*ε = %.2e\n', stopping_criterion);
if diff_norm <= stopping_criterion
    fprintf('✓ Критерий окончания выполнен!\n');
else
    fprintf('✗ Критерий окончания не выполнен за %d итераций\n', max_iter);
end

% Сравнение с прямым решением
x_direct = A \ b;
fprintf('\nСравнение с прямым решением:\n');
fprintf('Метод Зейделя:        [%.6f, %.6f, %.6f, %.6f]\n', x_seidel);
fprintf('Прямое решение:       [%.6f, %.6f, %.6f, %.6f]\n', x_direct');
fprintf('Разность:             [%.2e, %.2e, %.2e, %.2e]\n', x_seidel - x_direct);





